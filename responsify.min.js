/*! responsify - v0.2.1 - [object Object] - 2015-02-03 */!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Responsify=b(a)}):"undefined"!=typeof exports?module.exports=b(a):a.Responsify=b(a)}(this,function(){"use strict";var a={version:"0.2.1",options:{namespace:"responsify",selector:"img.responsive,div.responsive",lazyload:!1,breakpoints:[{label:"break-a",enter:0,exit:765},{label:"break-b",enter:768,exit:991},{label:"break-c",enter:992,exit:1199},{label:"break-d",enter:1200,exit:1e4}]},currentBreakpoint:null,images:[],events:{},interpolations:{},init:function(a){var b=this;a&&this.extend(this.options,a),this.setupDefaultInterpolations(),this.currentBreakpoint=this.findClosestBreakpoint(window.innerWidth),this.setupEvents();var c=setInterval(function(){if(b.addImages(b.getNewImages()),/^loaded|^i|^c/.test(window.document.readyState)){clearInterval(c);var a=new MutationObserver(function(){window.requestAnimationFrame(function(){b.addImages(b.getNewImages())})});return void a.observe(window.document.body,{childList:!0,subtree:!0})}},100)},setupDefaultInterpolations:function(){this.interpolations.width=function(a){return a.parentElement.clientWidth},this.interpolations.landscape=function(a){return Math.ceil(.5625*a.parentElement.clientWidth)},this.interpolations.height=function(a){return a.parentElement.clientHeight}},setupEvents:function(){var a=this;window.addEventListener("resize",function(){window.requestAnimationFrame(function(){a.onResizeEvent(window.innerWidth)})}),this.options.lazyload&&window.addEventListener("scroll",function(){window.requestAnimationFrame(function(){a.refreshImages()})})},getNewImages:function(){var a=this,b=[].slice.call(window.document.querySelectorAll(this.options.selector));return b.filter(function(b){return-1===a.images.indexOf(b)})},refreshImages:function(){this.renderImages(this.images)},resetImages:function(){this.images=[].slice.call(window.document.querySelectorAll(this.options.selector))},onResizeEvent:function(a){var b=null;if(isNaN(a))throw Error("Responsify.onResizeEvent(): expects parameter width of type Number");b=this.findClosestBreakpoint(a),b!=this.currentBreakpoint&&(this.setBreakpoint(b),this.refreshImages())},setBreakpoint:function(a){if("object"!=typeof a)throw new Error("Responsify.setBreakpoint(): expects parameter breakpoint of type Object");this.currentBreakpoint=a,this.publish("responsify:breakpoint:change",this.currentBreakpoint)},findClosestBreakpoint:function(a){if(isNaN(a))throw new Error("Responsify.findClosestBreakpoint(): expects parameter width of type Number");for(var b=0;b<this.options.breakpoints.length;b++)if(a>=this.options.breakpoints[b].enter&&a<=this.options.breakpoints[b].exit)return this.options.breakpoints[b]},isBreakpointEqualTo:function(a){if("string"!=typeof a)throw new Error("Responsify.isBreakpointEqualTo(): expects parameter breakpoint of type String");return a===this.currentBreakpoint.label},isElementVisible:function(a){if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.isElementVisible(): expects parameter el of type HTMLElement");return!!a.offsetParent},isElementInViewport:function(a){var b=a.getBoundingClientRect(),c=document.documentElement;return b.top<=(window.innerHeight||c.clientHeight)&&b.left>=0&&b.right<=(window.innerWidth||c.clientWidth)},renderImages:function(a){if(!a)throw new Error("Responsify.renderImages(): expects parameter images of type Array or NodeList");for(var b=0;b<a.length;b++)this.renderImage(a[b])},renderImage:function(a){var b="",c="",d="";if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.renderImage(): expects parameter el of type HTMLElement");return this.isElementVisible(a)?this.options.lazyload&&!this.isElementInViewport(a)?!1:(b=a.getAttribute("data-"+this.options.namespace)||"",c=a.getAttribute("data-"+this.options.namespace+"-"+this.currentBreakpoint.label)||"",a.naturalWidth>a.clientWidth&&""!==c?!1:(d=this.buildImageURI(b,c),d=this.getURLInterpolationsForElement(d,a),"img"===a.nodeName.toLowerCase()?a.src!==d&&(a.src=d):(a.style.backgroundImage="url('"+d+"')",a.style.backgroundSize="cover"),void this.publish("responsify:image:rendered",a))):!1},getURLInterpolationsForElement:function(a,b){for(var c=/{([^%}]+)?}/g,d=null;null!==(d=c.exec(a));)a=a.replace(d[0],this.interpolations[d[1]](b));return a},buildImageURI:function(a,b){var c="",d={};if("string"!=typeof a)throw new Error("Responsify.buildImageURI(): expects parameter baseURI of type String");if("string"!=typeof b)throw new Error("Responsify.buildImageURI(): expects parameter breakpointURI of type String");return b.match(/(http|https)/g)?b:(-1!==b.indexOf("?")?(d=b.split("?"),c=this.appendQueryString(a+d[0],d[1])):c=-1!==b.indexOf("=")?this.appendQueryString(a,b):a+b,c)},appendQueryString:function(a,b){var c;if("string"!=typeof a)throw new Error("Responsify.appendQueryString(): expects parameter uri of type String");return b?(b=b.replace(/^(&|\?)/,""),c=-1!==a.indexOf("?")?"&":"?",a+c+b):a},addImage:function(a){if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.addImage(): expects parameter img of type HTMLElement");this.images.push(a),this.renderImage(a)},addImages:function(a){for(var b=0;b<a.length;b++)this.addImage(a[b])},removeImage:function(a){if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.removeImages(): expects parameter img of type HTMLElement");for(var b=this.images.length;b--;)a===this.images[b]&&this.images.splice(b,1)},removeImages:function(a){if("[object NodeList]"!==Object.prototype.toString.call(a))throw new Error("Responsify.removeImages(): expects parameter imgs of type NodeList");for(var b=0;b<a.length;b++)this.removeImage(a[b])},publish:function(a){var b,c;if("string"!=typeof a)throw new Error("Responsify.publish(): expects parameter topic of type String");for(b=this.events[a],c=b?b.length:0;c--;)b[c].handler.apply(b[c].context,[].slice.call(arguments,1))},on:function(a,b,c){if("string"!=typeof a)throw new Error("Responsify.on(): expects parameter topic of type String");if("function"!=typeof b)throw new Error("Responsify.on(): expects parameter handler to of type Function");this.events[a]||(this.events[a]=[]),this.events[a].push({handler:b,context:c||this})},off:function(a,b){var c=0;if("string"!=typeof a)throw new Error("Responsify.off(): expects parameter topic of type String");if("function"!=typeof b)throw new TypeError("Responsify.off(): expects parameter handler of type Function");if(this.events[a])for(c=this.events[a].length;c--;)b&&this.events[a][c].handler!==b||this.events[a].splice(c,1)},extend:function(a,b){if("object"!=typeof a)throw new Error("Responsify.extend(): expects parameter destination of type Object");if("object"!=typeof b)throw new Error("Responsify.extend(): expects parameter source of type Object");for(var c in b)a[c]="object"==typeof b[c]&&"[object Array]"!==Object.prototype.toString.call(b[c])?this.extend(a[c],b[c]):b[c];return a}};return window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},window.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,a});