/*! responsify - v0.0.4 - eclifford <ericgclifford@gmail.com> - 2014-09-12 */!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Responsify=b(a)}):"undefined"!=typeof exports?module.exports=b(a):a.Responsify=b(a)}(this,function(){"use strict";var a={version:"0.0.4",options:{debug:!1,namespace:"responsify",selector:"img.responsive",root:document,dynamicWidth:!0,breakpoints:[{label:"break-a",device:"mobile",enter:0,exit:765},{label:"break-b",device:"tablet",enter:768,exit:991},{label:"break-c",device:"desktop",enter:992,exit:1199},{label:"break-d",device:"desktop",enter:1200,exit:1e4}]},activeBreakpoint:null,images:[],events:{},init:function(a){a&&this.extend(this.options,a),this.activeBreakpoint=this.calculateBreakpoint(window.innerWidth),this.images=[].slice.call(document.querySelectorAll(this.options.selector)),this.setupEvents(),this.options.debug&&this.setupDebug(this),this.processImages(this.images)},setupEvents:function(){var a=this;window.addEventListener("resize",function(){window.requestAnimationFrame(function(){a.onResizeEvent(window.innerWidth)})}),this.addMutationObserver(this.options.root,this.onImageDetected)},onImageDetected:function(a){this.images.push(a),this.processImage(a)},onScrollEvent:function(){this.processImages(this.images)},onResizeEvent:function(a){var b=this.calculateBreakpoint(a);b!=this.activeBreakpoint&&(this.activeBreakpoint=b,this.processImages(this.images),this.onBreakpointChange())},onBreakpointChange:function(){this.publish("responsify:breakpoint:change",this.activeBreakpoint)},calculateBreakpoint:function(a){for(var b=0;b<this.options.breakpoints.length;b++)if(a>=this.options.breakpoints[b].enter&&a<=this.options.breakpoints[b].exit)return this.options.breakpoints[b]},processImages:function(a){for(var b=0;b<a.length;b++)this.processImage(a[b])},processImage:function(a){var b=a.getAttribute("data-"+this.options.namespace)||"",c=a.getAttribute("data-"+this.options.namespace+"-"+this.activeBreakpoint.label)||"",d=this.buildImageURI(b,c);this.options.dynamicWidth&&(d=this.appendQueryString(d,"wid="+a.parentElement.clientWidth)),a.src!==d&&(this.setImageSource(a,d),this.publish("responsify:image:loaded"))},buildImageURI:function(a,b){var c="";if(-1!==b.indexOf("?")){var d=b.split("?");c=this.appendQueryString(a+d[0],d[1])}else c=-1!==b.indexOf("=")?this.appendQueryString(a,b):a+b;return c},setImageSource:function(a,b){a.src=b},appendQueryString:function(a,b){if(!b)return a;b=b.replace(/^(&|\?)/,"");var c=-1!==a.indexOf("?")?"&":"?";return a+c+b},addMutationObserver:function(a,b){var c=this,d=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,e=new d(function(a){a.forEach(function(a){if(a.addedNodes)for(var d=0;d<a.addedNodes.length;d++){var e=a.addedNodes[d];if(1==e.nodeType&&"IMG"==e.tagName&&b.call(c,e),1==e.nodeType&&"DIV"==e.tagName)for(var f=e.querySelectorAll(c.options.selector),g=0;g<f.length;g++)b.call(c,f[g])}})});e.observe(a,{childList:!0,subtree:!0})},publish:function(a){for(var b=this.events[a],c=b?b.length:0,d=[].slice.call(arguments,1);c--;)b[c].callback.apply(b[c].context,d)},on:function(a,b,c){this.events[a]||(this.events[a]=[]),this.events[a].push({callback:b,context:c||this})},extend:function(a,b){a=a||{};for(var c in b)a[c]="object"==typeof b[c]&&"[object Array]"!==Object.prototype.toString.call(b[c])?this.extend(a[c],b[c]):b[c];return a},setupDebug:function(a){for(var b=this,c=Object.getOwnPropertyNames(a),d=0;d<c.length;d++)"function"==typeof a[c[d]]&&!function(d){var e=a[c[d]];a[c[d]]=function(){console.groupCollapsed("Responsify: %s",c[d],[].slice.call(arguments)),console.time("time");var a=e.apply(b,arguments);return console.timeEnd("time"),console.groupEnd(),a}}(d)}};return window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},a});