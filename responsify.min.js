/*! responsify - v0.0.1 - eclifford <ericgclifford@gmail.com> - 2014-07-17 */!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Responsify=b(a)}):"undefined"!=typeof exports?module.exports=b(a):a.Responsify=b(a)}(this,function(){"use strict";var a={version:"0.0.1",breakpoints:["750","970","1170","1600"],activeBreakpoint:null,images:[],debounceDelay:300,selector:"img.responsive",init:function(a){var b=this;a&&this.setConfig(a),this.activeBreakpoint=this.getClosestBreakpoint(),this.images=document.getElementsByClassName("responsive"),this.processImages(this.images),this.onImageLoaded(function(a){b.images.push(a),b.isImageOnScreen(a)&&b.processImage(a)}),this.onScrollEvent(function(){b.processImages(b.images)}),this.onResizeEvent(function(){var a=b.getClosestBreakpoint();a!=b.activeBreakpoint&&(b.activeBreakpoint=a,b.processImages(b.images))})},setConfig:function(a){"undefined"!==a.breakpoints&&null!==a.breakpoints&&(this.breakpoints=a.breakpoints)},getClosestBreakpoint:function(){var a=window.innerWidth;if(a<=this.breakpoints[0])return 0;if(a>=this.breakpoints[this.breakpoints.length-1])return this.breakpoints.length-1;for(var b=0;b<this.breakpoints.length;b++)if(a<=this.breakpoints[b]&&a>this.breakpoints[b-1])return b+1},processImages:function(a){for(var b=0;b<a.length;b++)this.isImageOnScreen(a[b])&&this.processImage(a[b])},addUpdateQueryStringParameter:function(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=-1!==a.indexOf("?")?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c},parseQueryStringToObj:function(a){var b={};return a?(a.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(a,c,d,e){b[c]=e}),b):{}},processImage:function(a){var b=a.dataset.src,c=this.parseQueryStringToObj(a.dataset["src-"+(this.activeBreakpoint+1)]);for(var d in c)b=this.addUpdateQueryStringParameter(b,d,c[d]);b=this.addUpdateQueryStringParameter(b,"wid",a.parentElement.clientWidth),a.src!==b&&(a.src=b)},isImageOnScreen:function(a){var b=a.getBoundingClientRect(),c=document.body.clientHeight;return b.top>=0&&b.top<=c||b.bottom>=0&&b.bottom<=c?!0:!1},onScrollEvent:function(a){window.addEventListener("scroll",this.debounce(function(){a()},this.debounceDelay))},onImageLoaded:function(a){var b=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,c=new b(function(b){b.forEach(function(b){if(b.addedNodes)for(var c=0;c<b.addedNodes.length;c++){var d=b.addedNodes[c];1==d.nodeType&&"IMG"==d.tagName&&a(d)}})});c.observe(document,{childList:!0,subtree:!0})},onResizeEvent:function(a){window.addEventListener("resize",this.debounce(function(){a()},this.debounceDelay))},debounce:function(a,b,c){var d,e,f,g,h,i=function(){var j=Date.now-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=Date.now;var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}}};return a});