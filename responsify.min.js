/*! responsify - v0.1.0 - [object Object] - 2014-10-13 */!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Responsify=b(a)}):"undefined"!=typeof exports?module.exports=b(a):a.Responsify=b(a)}(this,function(){"use strict";var a={version:"0.1.0",options:{namespace:"responsify",selector:"img.responsive,div.responsive",breakpoints:[{label:"break-a",enter:0,exit:765},{label:"break-b",enter:768,exit:991},{label:"break-c",enter:992,exit:1199},{label:"break-d",enter:1200,exit:1e4}],supportedWidths:[],supportedPixelDensity:[1,1.3,2]},currentBreakpoint:null,images:[],events:{},init:function(a){a&&this.extend(this.options,a),this.currentBreakpoint=this.findClosestBreakpoint(window.innerWidth),this.refreshImages(),this.setupEvents(),this.renderImages(this.images)},setupEvents:function(){var a=this;window.addEventListener("resize",function(){window.requestAnimationFrame(function(){a.onResizeEvent(window.innerWidth)})})},refreshImages:function(){this.images=[].slice.call(document.querySelectorAll(this.options.selector))},onResizeEvent:function(a){var b=null;if(isNaN(a))throw Error("Responsify.onResizeEvent(): expects parameter width of type Number");b=this.findClosestBreakpoint(a),b!=this.currentBreakpoint&&(this.setBreakpoint(b),this.renderImages(this.images))},setBreakpoint:function(a){if("object"!=typeof a)throw new Error("Responsify.setBreakpoint(): expects parameter breakpoint of type Object");this.currentBreakpoint=a,this.publish("responsify:breakpoint:change",this.currentBreakpoint)},findClosestBreakpoint:function(a){if(isNaN(a))throw new Error("Responsify.findClosestBreakpoint(): expects parameter width of type Number");for(var b=0;b<this.options.breakpoints.length;b++)if(a>=this.options.breakpoints[b].enter&&a<=this.options.breakpoints[b].exit)return this.options.breakpoints[b]},isBreakpointEqualTo:function(a){if("string"!=typeof a)throw new Error("Responsify.isBreakpointEqualTo(): expects parameter breakpoint of type String");return a===this.currentBreakpoint.label},isElementVisible:function(a){if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.isElementVisible(): expects parameter el of type HTMLElement");return a.parentElement.offsetWidth>0&&a.parentElement.offsetHeight>0},renderImages:function(a){if(!a)throw new Error("Responsify.renderImages(): expects parameter images of type Array or NodeList");for(var b=0;b<a.length;b++)this.isElementVisible(a[b])&&this.renderImage(a[b])},renderImage:function(a){var b="",c="",d="",e=0,f=1,g=0;if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.renderImage(): expects parameter el of type HTMLElement");b=a.getAttribute("data-"+this.options.namespace)||"",c=a.getAttribute("data-"+this.options.namespace+"-"+this.currentBreakpoint.label)||"",d=this.buildImageURI(b,c),d.match(/{width}/g)&&(e=this.getClosestSupportedWidth(a.parentElement.clientWidth),f=this.getClosestSupportedPixelRatio(this.getPixelRatio()),g=e*f,d=d.replace(/{width}/g,g)),"img"===a.nodeName.toLowerCase()?a.src!==d&&(a.src=d):(a.style.backgroundImage="url('"+d+"')",a.style.backgroundSize="cover"),this.publish("responsify:image:rendered",a)},getClosestSupportedWidth:function(a){var b=this.options.supportedWidths.length,c=0;if(isNaN(a))throw new Error("Responsify.getClosestSupportedWidth(): expects parameter width of type Number");if(0===b)return a;for(;b--;)a<=this.options.supportedWidths[b]&&(c=this.options.supportedWidths[b]);return c},getPixelRatio:function(){return window.devicePixelRatio||1},getClosestSupportedPixelRatio:function(a){var b=this.options.supportedPixelDensity.length,c=1;if(isNaN(a))throw new Error("Responsify.getClosestSupportedPixelRatio(): expects parameter ratio of type Number");for(;b--;)a<=this.options.supportedPixelDensity[b]&&(c=this.options.supportedPixelDensity[b]);return c},buildImageURI:function(a,b){var c="",d={};if("string"!=typeof a)throw new Error("Responsify.buildImageURI(): expects parameter baseURI of type String");if("string"!=typeof b)throw new Error("Responsify.buildImageURI(): expects parameter breakpointURI of type String");return-1!==b.indexOf("?")?(d=b.split("?"),c=this.appendQueryString(a+d[0],d[1])):c=-1!==b.indexOf("=")?this.appendQueryString(a,b):a+b,c},appendQueryString:function(a,b){var c;if("string"!=typeof a)throw new Error("Responsify.appendQueryString(): expects parameter uri of type String");return b?(b=b.replace(/^(&|\?)/,""),c=-1!==a.indexOf("?")?"&":"?",a+c+b):a},addImage:function(a){if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.addImage(): expects parameter img of type HTMLElement");this.images.push(a),this.renderImage(a)},addImages:function(a){if("[object NodeList]"!==toString.call(a))throw new Error("Responsify.addImages(): expects parameter imgs of type NodeList");for(var b=0;b<a.length;b++)this.addImage(a[b])},removeImage:function(a){if(!(a&&a instanceof HTMLElement))throw new Error("Responsify.removeImages(): expects parameter img of type HTMLElement");for(var b=this.images.length;b--;)a===this.images[b]&&this.images.splice(b,1)},removeImages:function(a){if("[object NodeList]"!==toString.call(a))throw new Error("Responsify.removeImages(): expects parameter imgs of type NodeList");for(var b=0;b<a.length;b++)this.removeImage(a[b])},publish:function(a){var b,c;if("string"!=typeof a)throw new Error("Responsify.publish(): expects parameter topic of type String");for(b=this.events[a],c=b?b.length:0;c--;)b[c].handler.apply(b[c].context,[].slice.call(arguments,1))},on:function(a,b,c){if("string"!=typeof a)throw new Error("Responsify.on(): expects parameter topic of type String");if("function"!=typeof b)throw new Error("Responsify.on(): expects parameter handler to of type Function");this.events[a]||(this.events[a]=[]),this.events[a].push({handler:b,context:c||this})},off:function(a,b){var c=0;if("string"!=typeof a)throw new Error("Responsify.off(): expects parameter topic of type String");if("function"!=typeof b)throw new TypeError("Responsify.off(): expects parameter handler of type Function");if(this.events[a])for(c=this.events[a].length;c--;)b&&this.events[a][c].handler!==b||this.events[a].splice(c,1)},extend:function(a,b){if("object"!=typeof a)throw new Error("Responsify.extend(): expects parameter destination of type Object");if("object"!=typeof b)throw new Error("Responsify.extend(): expects parameter source of type Object");for(var c in b)a[c]="object"==typeof b[c]&&"[object Array]"!==Object.prototype.toString.call(b[c])?this.extend(a[c],b[c]):b[c];return a}};return window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},a});